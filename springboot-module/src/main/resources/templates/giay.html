<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Thêm giày</title>
    <link rel="stylesheet" th:href="@{/css/giay.css}"/>
    <!-- bootstrap 3.3.7 css -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
    <!--alert css-->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.11.2/build/css/alertify.min.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.11.2/build/css/themes/bootstrap.min.css"/>
    <!--select2 css-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css"
          href="https://select2.github.io/select2-bootstrap-theme/css/select2-bootstrap.css"/>

    <link th:href="@{/upload-multi-firebase/fileinput.css}" rel="stylesheet" type="text/css"/>
    <!-- fontawesome (icon) -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"/>

</head>

<body>
<ol class="breadcrumb">
    <li><a href="/dsgiay">Danh sách giày</a></li>
    <li class="active"><b>Thêm mới</b></li>
</ol>
<div id="App" ng-app="myApp" ng-controller="myCtrl">
    <form action="" id="giayForm" method="POST" role="form">
        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <legend>Thông tin giày

                    </legend>
                    <button type="button" style="float: right;" class="btn" id="btnReset"
                            name="btnReset"><i class="fas fa-sync-alt"></i></button>
                    <div class="row bot15">
                        <div class=" col-xs-12 col-sm-4 col-md-4">
                            <label for="txtMaGiay">Mã giày</label>
                            <input type="text" class="form-control" name="txtMaGiay" id="txtMaGiay" maxlength="20"/>
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-4">
                            <label for="txtTenGiay">Tên giày</label>
                            <input type="text" class="form-control" name="txtTenGiay" id="txtTenGiay" maxlength="50"/>
                        </div>
                        <div class="col-xs-12 col-sm-3">
                            <label for="txtLoaiGiay">Loại giày</label>
                            <select class="form-control select2" id="txtLoaiGiay" name="txtLoaiGiay">
                                <option></option>
                                <optgroup ng-repeat="(key, value) in LoaiGiay | groupBy: 'hangSanXuat.tenHangSanXuat'"
                                          label="{{key}}">
                                    <option ng-repeat="x in value" value="{{x.idLoaiGiay}}">
                                        {{x.tenLoaiGiay}}
                                    </option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    <div class="row bot15">
                        <div class="col-xs-12 col-sm-4">
                            <label for="txtGhiChu">Ghi chú</label>
                            <textarea name="txtGhiChu" id="txtGhiChu" class="form-control" rows="4" cols="50"
                                      maxlength="186"></textarea>
                        </div>
                        <div class=" col-xs-12 col-sm-4">
                            <label for="txtGiaBan">Giá bán</label>
                            <input type="text" class="form-control" name="txtGiaBan" id="txtGiaBan" maxlength="15"/>
                        </div>
                        <div class="col-xs-12 col-sm-3">
                            <label for="txtLoaiGiay">Giới tính</label>
                            <select id="txtGioiTinh" class="form-control">
                                <option ng-repeat="gioitinh in GioiTinh" value="{{gioitinh.idGioiTinh}}">
                                    {{gioitinh.tenGioiTinh}}
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <legend>Hình ảnh</legend>
                    <div class="container kv-main">
                        <div id="divUploading" hidden="true">
                            <div class="loader"></div>
                        </div>
                        <div id="RequirementImg" hidden="true">
                            Yêu cầu tải lên ít nhất 1 hình ảnh
                        </div>
                        <div id="divAlert" class="alert alert-success" role="alert" hidden="true">
                            Tải ảnh lên thành công
                        </div>
                        <div class="form-group">
                            <div class="file-loading">
                                <input id="fileUploader" name="fileUploader" type="file" multiple="multiple"
                                       class="file"
                                       data-overwrite-initial="false" data-min-file-count="2"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row bot15">
                <div class="col-xs-2 col-sm-2">
                    <a class="btn btn-success" id="btnLuu" name="btnLuu">Lưu</a>
                </div>
            </div>
        </div>
    </form>
    <div class="modal fade" id="BoxModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <a data-dismiss="modal" style="float: right; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </a>
                    <h4 class="modal-title">Chi tiết giày</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-12 col-sm-8 col-md-6">
                            <div class="row bot15">
                                <div class="col-md-6">
                                    <label>Kích thước giày</label>
                                    <input type="text" name="item" class="form-control" id="add"/>
                                </div>
                                <div class="col-md-6">
                                    <button type="button" id="addbtn" name="addbtn" style="margin-top: 25px;"
                                            class="btn btn-primary"><i class="fas fa-plus-square"></i></button>
                                </div>
                            </div>
                            <div class="form-group">
                                <ul id="list" class="list-group">
                                    <!-- <div style="margin-top: 5px;">
                                        <input type="text" class="form-control" style="width: 60%; float:left;"
                                         name="listSize[]" value="'+newitem+'" />
                                        <input type="hidden" name="listed[]" value="" />&nbsp;
                                        <button class="btn btn-light listelement"><i class="fas fa-trash-alt"></i></button>
                                    </div> -->

                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info" data-dismiss="modal">Lưu</button>
                </div>
            </div>
        </div>
    </div>

</div>
<!-- jquery 3.3.1 -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<!--alert-->
<script src="//cdn.jsdelivr.net/npm/alertifyjs@1.11.2/build/alertify.min.js"></script>
<!-- bootstrap JS -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!-- angularJS -->
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-filter/0.5.17/angular-filter.min.js"></script>

<!-- select2 (select box) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>

<!-- Upload files img -->
<script th:src="@{/upload-multi-firebase/fileinput.js}" type="text/javascript"></script>
<script th:src="@{/upload-multi-firebase/vi.js}" type="text/javascript"></script>
<script th:src="@{/upload-multi-firebase/theme.js}" type="text/javascript"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.0/firebase.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
        type="text/javascript"></script>

<script th:src="@{/js/giay.js}">
</script>
<!--jquery validate-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.18.0/jquery.validate.min.js"></script>
<script>
    var config = {
        apiKey: "AIzaSyDusFKebmjFEOzdWOQnMgwF6DZBRmRZBzc",
        authDomain: "chatbox-50976.firebaseapp.com",
        databaseURL: "https://chatbox-50976.firebaseio.com",
        projectId: "chatbox-50976",
        storageBucket: "chatbox-50976.appspot.com",
        messagingSenderId: "77533622093"
    };
    firebase.initializeApp(config);
</script>
<script>
    $("#fileUploader").fileinput({
        language: 'vi',
        theme: 'fa',
        uploadUrl: '#', // you must set a valid URL here else you will get an error
        allowedFileExtensions: ['jpg', 'png'],
        overwriteInitial: false,
        minFileCount: 1,
        maxFileCount: 4,
        initialPreview:['https://firebasestorage.googleapis.com/v0/b/chatbox-50976.appspot.com/o/images%2F456.PNG?alt=media&amp;token=9b714d49-111f-45e9-bbec-6acaeae7a382'] ,
        initialPreviewAsData: true,
        allowedFileTypes: ['image'],
        slugCallback: function (filename) {
            return filename.replace('(', '_').replace(']', '_');
        }
    });
</script>
<script>
    var uploadURL = new Array();
    uploadSimpleFile

    function uploadSimpleFile(imageFile, index, length) {
        return new Promise(function (resolve, reject) {
            var fbBucketName = 'images';
            var storageRef = firebase.storage().ref(`${fbBucketName}/${imageFile.name}`);
            var uploadTask = storageRef.put(imageFile);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, function (snapshot) {
                // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                $('#process').css('width', progress + '%');
                console.log('Upload is ' + progress + '% done');
                switch (snapshot.state) {
                    case firebase.storage.TaskState.PAUSED: // or 'paused'
                        console.log('Upload is paused');
                        break;
                    case firebase.storage.TaskState.RUNNING: // or 'running'
                        console.log('Upload is running');
                        break;
                }
            }, function (error) {
                // A full list of error codes is available at
                // https://firebase.google.com/docs/storage/web/handle-errors
                switch (error.code) {
                    case 'storage/unauthorized':
                        // User doesn't have permission to access the object
                        break;
                    case 'storage/canceled':
                        // User canceled the upload
                        break;
                    case 'storage/unknown':
                        // Unknown error occurred, inspect error.serverResponse
                        break;
                }
            }, function () {
                if (index == length - 1) {
                    $('#divAlert').attr('hidden', false);
                    $('#divUploading').attr('hidden', true);
                }
                uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {
                    uploadURL.push(downloadURL);
                    console.log('File available at', downloadURL);
                });
            });
        });
    }
</script>

</body>

</html>